-- QUESTIONS ARE SOLVED USING POSTGRESQL

1. Given a table of candidates and their skills, you're tasked with finding the candidates best suited for an open Data Science job. You want to find candidates who are proficient in Python, Tableau, and PostgreSQL.
Write a query to list the candidates who possess all of the required skills for the job. Sort the output by candidate ID in ascending order.

-- SQL SOLUTION
select candidate_id from candidates
where skill in ('Python', 'Tableau', 'PostgreSQL')
group by candidate_id
having count(skill) = 3

2. PAGES WITH NO LIKES

-- SQL SOLUTION
SELECT p.page_id FROM pages p
LEFT JOIN page_likes l ON p.page_id = l.page_id
WHERE l.liked_date IS NULL
ORDER BY p.page_id;

3. Tesla is investigating production bottlenecks and they need your help to extract the relevant data. Write a query to determine which parts have begun the assembly process but are not yet finished.

-- SQL SOLUTION
SELECT part, assembly_step FROM parts_assembly
WHERE finish_date IS NULL;

4. Assume you're given the table on user viewership categorised by device type where the three types are laptop, tablet, and phone.
Write a query that calculates the total viewership for laptops and mobile devices where mobile is defined as the sum of tablet and phone viewership. 
Output the total viewership for laptops as laptop_reviews and the total viewership for mobile devices as mobile_views.

-- SQL SOLUTION
SELECT 
  SUM(CASE WHEN device_type = "laptop" THEN 1
      ELSE 0 
      END) AS laptop_views,
  SUM(CASE WHEN device_type in ("tablet","phone") THEN 1 
      ELSE 0
      END) AS mobile_views
FROM viewership;

5. Given a table of Facebook posts, for each user who posted at least twice in 2021, write a query to find the number of days between each userâ€™s 
first post of the year and last post of the year in the year 2021. Output the user and the number of days between each user's first and last post.

-- SQL SOLUTION
SELECT 
    user_id,
    MAX(post_date::DATE) - MIN(post_date::DATE) AS days_between
FROM posts
WHERE EXTRACT(YEAR FROM post_date) = 2021
GROUP BY user_id
HAVING COUNT(post_id) > 1 ;

6. Write a query to identify the top 2 Power Users who sent the highest number of messages on Microsoft Teams in August 2022. Display the IDs of these 2 users along with the total number of 
messages they sent. Output the results in descending order based on the count of the messages.

-- SQL SOLUTION
SELECT sender_id, count(message_id) AS message_count FROM messages
WHERE EXTRACT(YEAR FROM sent_date) = 2022 and EXTRACT(MONTH FROM sent_date) = 8
GROUP BY sender_id
ORDER BY message_count DESC
LIMIT 2;

7. Assume you're given a table containing job postings from various companies on the LinkedIn platform. Write a query to retrieve the count of companies that have posted duplicate job listings.

-- SQL SOLUTION
WITH job_count AS (
  SELECT company_id, title, description, count(job_id) AS jobs
  FROM job_listings
  GROUP BY company_id, title, description
)

SELECT company_id FROM job_count
WHERE jobs > 1;

8. Assume you're given the tables containing completed trade orders and user details in a Robinhood trading system. Write a query to retrieve the top three cities that have the highest number of 
completed trade orders listed in descending order. Output the city name and the corresponding number of completed trade orders.

-- SQL SOLUTION
SELECT city, count(order_id) AS completed_trades
FROM trades t join users u on t.user_id = u.user_id
WHERE status = 'Completed'
GROUP BY city
ORDER BY completed_trades DESC
LIMIT 3;

9. Given the reviews table, write a query to retrieve the average star rating for each product, grouped by month. The output should display the month as a numerical value, product ID, 
and average star rating rounded to two decimal places. Sort the output first by month and then by product ID.

-- SQL SOLUTION
SELECT 
  EXTRACT( MONTH FROM submit_date) AS month, 
  product_id, 
  round(avg(stars),2) FROM reviews
GROUP BY product_id, month
ORDER BY month, product_id;

10. Companies often perform salary analyses to ensure fair compensation practices. One useful analysis is to check if there are any employees earning more than their direct managers.
As a HR Analyst, you're asked to identify all employees who earn more than their direct managers. The result should include the employee's ID and name.

-- SQL SOLUTION
SELECT e1.employee_id, e1.name
FROM employee e1 join employee e2 on e2.employee_id = e1.manager_id
where e1.salary > e2.salary;

11. Given a table containing information about bank deposits and withdrawals made using Paypal, write a query to retrieve the final account balance for each account,
taking into account all the transactions recorded in the table with the assumption that there are no missing transactions.

-- SQL SOLUTION
SELECT 
  account_id, 
  SUM(CASE WHEN transaction_type = 'Deposit' THEN +amount
    ELSE -amount
    END) AS final_balance
FROM transactions
GROUP BY account_id;

12. Intuit provides a range of tax filing products, including TurboTax and QuickBooks, available in various versions.
Write a query to determine the total number of tax filings made using TurboTax and QuickBooks. Each user can file taxes once a year using only one product.

-- SQL SOLUTION
SELECT 
  COUNT(CASE WHEN (product LIKE 'TurboTax%') THEN filing_id END) AS turbotax_total,  
  COUNT(CASE WHEN (product LIKE 'QuickBooks%') THEN filing_id END) AS quickbooks_total
FROM filed_taxes;

13. Assume you have an events table on Facebook app analytics. Write a query to calculate the click-through rate (CTR) for the app in 2022 and round the results to 2 decimal places.

-- SQL SOLUTION
SELECT
  app_id,
  ROUND(100.0 *
    SUM(CASE WHEN event_type = 'click' THEN 1 ELSE 0 END) /
    SUM(CASE WHEN event_type = 'impression' THEN 1 ELSE 0 END), 2)  AS CTR_PERC
FROM events
WHERE EXTRACT(YEAR FROM timestamp) = 2022
GROUP BY app_id;

14.

-- SQL SOLUTION
SELECT e.user_id
FROM emails e JOIN texts t ON e.email_id = t.email_id
WHERE action_date =  signup_date + INTERVAL '1 day' 
  and signup_action = 'Confirmed'



